<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Welcome To HelsingenMersken</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Welcome To HelsingenMersken">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Welcome To HelsingenMersken">
<meta property="og:locale">
<meta property="article:author" content="HelsingenMersken">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Welcome To HelsingenMersken" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome To HelsingenMersken</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-分析空调遥控器编码" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/01/%E5%88%86%E6%9E%90%E7%A9%BA%E8%B0%83%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81/" class="article-date">
  <time class="dt-published" datetime="2020-08-01T14:26:10.000Z" itemprop="datePublished">2020-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/01/%E5%88%86%E6%9E%90%E7%A9%BA%E8%B0%83%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81/">分析空调遥控器编码</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>上一步中获取了遥控器的红外数据，接下来就需要解析了</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-212951.jpg"></p>
<p>观察这126组数据，显然72组数据后的数据电平时钟不变，时间也是满的（9637us）。说明该遥控器数据位共72位。</p>
<h2 id="开机位"><a href="#开机位" class="headerlink" title="开机位"></a>开机位</h2><p>接下来用控制变量法获取数据解析，首先是开关机位。分别获得 制冷 25度 自动风 摆风 下的开关机码。建议将打印出来的数据导入excel分析比较方便。将前后电平时间相减，差值小于100的认为是系统误差，大于的认为是数据差。很明显第9位和65位数据差值大于1000 。二者应该只有一个位控制开关机，剩下一个数据区别应该为检验和区别，正常人都会把校验和放在最后，所以大胆预测第九位控制开关机 ，65位及附近数据为检验位。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-213513.jpg"></p>
<h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><p>上面推算出来了开机位，注意数据格式 大胆猜测 <strong>起始信号</strong>为4100us的高电平和450us左右的低电平组成 数据信号的第二个电平为0 且时间为450us左右 ，而第一个电平为高电平时间为420us或1550us，对应的应该为数据0 和1 （关于这里的推测，联系上面的开机位，正常人都会把开机设为1，关机设为0），这样大致的数据格式推测出来了，可能有错误，继续用控制变量法获取数据分析，有错再改。</p>
<h2 id="温度控制位"><a href="#温度控制位" class="headerlink" title="温度控制位"></a>温度控制位</h2><p>分别采集 开机 制冷 自动风 摆风 前提下 25度和26度的数据，发现有15 16两位 30 31位 以及65位前后不一样，首先可以肯定的是上面的开关机位推断正确，但是仍然看不出来温度变化规律。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-220516.jpg"></p>
<p>25和26对比</p>
<p>大胆一点，干脆把温度调到最低看，特么的，怎么还是那三处不一样。没办法，只能带进去假设演算了。18度和25度第一个区别就是13 15 16 不一样，将数据按上一步推测的换成0或1，可得18度时为0010，25度为1001. 加减一下可以发现：25-18==7==1001-0010 ；这样规律很可能是 temperature - 18 = n - 0010 将26度的数据带入演算，推断成立。该遥控器支持最大温度为32度，哎，四位数最多到31，需要5bit。大胆再猜下12-16 5bit都是控制温度的，32度时为10000. 控制变量将温度设置为32度，发现上述推断成立。</p>
<p>注意28-32位数据和温度有关，但是没看出来具体关联，可能是某类校验，先跳过</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-220701.jpg"></p>
<p>18和25度对比</p>
<h2 id="模式控制位"><a href="#模式控制位" class="headerlink" title="模式控制位"></a>模式控制位</h2><p>直接将上述模式切换为送风模式，发现只有2-16bit 上数据为00001有不同，特么怎么又跑到温控位了？但是18度时为00010，下面确实有一位没用，可能送风模式比较特殊，直接用温控位代替了。</p>
<p>继续分析其他模式，将模式切换为制热模式，发现这次变的地方太多了，等下再继续分析模式</p>
<h2 id="风速控制位"><a href="#风速控制位" class="headerlink" title="风速控制位"></a>风速控制位</h2><p>分别获取 自动模式 24 不扫风下的强中低三种风速</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-02-143341-1024x71.jpg"></p>
<p>发现55 56两位区别，弱风为01 中为10 强风为11 该遥控器还有一个自动风，应该为00，将00带入之前开机位测试的码型中，结论成立。</p>
<h2 id="摆风控制"><a href="#摆风控制" class="headerlink" title="摆风控制"></a>摆风控制</h2><p>同理可得41位控制摆风</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-02-233614-1024x186.jpg"></p>
<h2 id="风向控制"><a href="#风向控制" class="headerlink" title="风向控制"></a>风向控制</h2><p>45位为方向控制位，该位使能后摆风失能，导风板切换方向一次</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-03-012830-1024x95.jpg"></p>
<h2 id="起始码和地址码"><a href="#起始码和地址码" class="headerlink" title="起始码和地址码"></a>起始码和地址码</h2><p>经过上述分析过程，堆积样本码数量足够多了，仔细观察前九位，数据完全一样。第一位格式较特殊，起始码推断应该没问题。再往后八位：01010101，数据完全一样，推断大概率可能为地址码</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-03-013649-1024x193.jpg"></p>
<h2 id="数显控制位"><a href="#数显控制位" class="headerlink" title="数显控制位"></a>数显控制位</h2><p>46-48为数显控制位，000保持当前 111切换状态</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-03-015108.jpg"></p>
<h2 id="超静控制位"><a href="#超静控制位" class="headerlink" title="超静控制位"></a>超静控制位</h2><p>62位为超静控制位，1：使能超静模式</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-03-092036-1024x108.jpg"></p>
<h2 id="定时控制位"><a href="#定时控制位" class="headerlink" title="定时控制位"></a>定时控制位</h2><p>多次采集对比发现 11 36-40 57 58都和时间有关联</p>
<p>11位较为明显，控制定时功能是否开启，为1时开启</p>
<p>36-40位控制定时时间，此部分较为特殊，当t&lt;=5h时，该部分值为2t。当t&gt;5 h时，数据为1010+（t-5h）。</p>
<p>57 58两位控制定时状态 ，具体不清楚</p>
<p>该功能用不上，定时时间选择太小，还不如用单片机定时器直接定时方便（逃</p>
<h2 id="模式控制位-1"><a href="#模式控制位-1" class="headerlink" title="模式控制位"></a>模式控制位</h2><p>前面已经分析一半多的码了，继续分析模式，依次切换模式尝试（自动、送风模式下温度无法控制，分析时排出温度位和温度相关位（12-16，28-32））</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-04-101944-1024x111.jpg"></p>
<p>50-52位控制模式，自动(000)-&gt;制冷(001)-&gt;除湿(010)-&gt;送风(011)-&gt;制热(100).</p>
<p>值得注意的是，此时送风模式下得到的温度值是24(01000),这和之前温度分析不一样？？？然后我去翻了之前保留的数据，发现温度值是24，而不是之前写的00001？？？</p>
<h2 id="睡眠控制位"><a href="#睡眠控制位" class="headerlink" title="睡眠控制位"></a>睡眠控制位</h2><p>19位为睡眠控制位，为1使能睡眠功能</p>
<p>先睡觉，起来再写，狗命要紧</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/08/01/%E5%88%86%E6%9E%90%E7%A9%BA%E8%B0%83%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81/" data-id="ckr0rt79k000ypct9fu4kb29l" data-title="分析空调遥控器编码" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-esp32配置rmt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/16/esp32%E9%85%8D%E7%BD%AErmt/" class="article-date">
  <time class="dt-published" datetime="2020-07-16T13:22:41.000Z" itemprop="datePublished">2020-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/16/esp32%E9%85%8D%E7%BD%AErmt/">ESP32配置RMT接收功能</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>懒癌晚期，一个月没更了（逃</p>
<h2 id="一-什么是RMT？能干啥？"><a href="#一-什么是RMT？能干啥？" class="headerlink" title="一 什么是RMT？能干啥？"></a>一 什么是RMT？能干啥？</h2><p>RMT(Remote Control)即红外遥控，通过红外传输数据。学单片机的时候，不管是51还是stm32，肯定有个红外遥控。而且做得都是接收数据解析，想要控制空调之类的家电要干的事居多</p>
<h2 id="二-首先是怎么通过红外传输数据"><a href="#二-首先是怎么通过红外传输数据" class="headerlink" title="二 首先是怎么通过红外传输数据"></a>二 首先是怎么通过红外传输数据</h2><p>数字信号-&gt;模拟信号-&gt;红外光线-&gt;模拟信号-&gt;数字信号</p>
<p>主要的工作就是把数字信号调制成红外信号再将红外信号解调成数字信号。最简单的当然是直接把灯亮灭当0/1，但是如何排除干扰项呢？显然这是不行的。一般而言，红外传输是先把数据转化为NEC格式的编码或者PPM编码，之后再将数据加载到载波信号（一般为38KHz）上完成调制过程。</p>
<p><img src="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/_images/blockdiag-4dccba433bcc07c0f5b31ae336ac21a03604bb9a.png"></p>
<p>调制过程</p>
<h2 id="三-具体的API调用"><a href="#三-具体的API调用" class="headerlink" title="三 具体的API调用"></a>三 具体的API调用</h2><p>信号调制过程可以使用定时器+PWM信号完成，本憨批一开始就是这么做的…后来发现乐鑫的ESP32提供了RMT功能的API：<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/peripherals/rmt.html#c.RMT_MEM_ITEM_NUM">官方API参考</a></p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>通过初始化结构体 <em>rmt_config_t</em> ，再调用函数_rmt_config(_)和_rmt_driver_install()_完成配置，需要注意的是esp32默认的内存块只能存下63bit的数据，空调这些绝对不是什么省油的灯，需要将mem_block_num设置为2。126应该够大多数场景用了。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-211912-1024x313.jpg"></p>
<p>红外接收初始化函数</p>
<p>接下来是数据的解析,读取缓存区并将数据打印出来。缓存的数据是保存在rmt_item32_t结构体中 ，该结构体主要成员为level0,duration0,level1,duration1.即两组电平、时间。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-211550-1024x98.jpg"></p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/08/%E6%89%B9%E6%B3%A8-2020-08-01-211716.jpg"></p>
<p>打印出来的数据</p>
<p>看到打印出来的数据后需要自行解析了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/16/esp32%E9%85%8D%E7%BD%AErmt/" data-id="ckr0rt794000cpct93rjg0t2v" data-title="ESP32配置RMT接收功能" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-树莓派部署wordpress博客" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/13/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%83%A8%E7%BD%B2wordpress%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time class="dt-published" datetime="2020-06-13T15:05:15.000Z" itemprop="datePublished">2020-06-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/13/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%83%A8%E7%BD%B2wordpress%E5%8D%9A%E5%AE%A2/">树莓派部署Wordpress博客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先安装Apache</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2 -y</span><br></pre></td></tr></table></figure>

<p>安装完成可以在localhost打开，如果是无桌面版的，同一局域网的设备直接访问树莓派ip地址。安装成功则可以在浏览器内看到下列内容</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-154515-1024x526.jpg"></p>
<p>接下来是安装数据库，第一个坑来了，很多老教程是装MySQL，不好意思，新树莓派系统木得，需要换成MriaDB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mariadb-server </span><br></pre></td></tr></table></figure>

<p>中间问你装不装，填个y，回车。完成后通过下个命令连接mriaDB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql </span><br></pre></td></tr></table></figure>

<p>出现下图即为成功连接到MariaDB</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-155256.jpg"></p>
<p>接着需要给root用户修改密码（自行替换password）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use mysql; </span><br><span class="line">UPDATE user SET password=password(&#x27;password&#x27;) WHERE user=&#x27;root&#x27;; </span><br><span class="line">UPDATE user SET plugin=&#x27;mysql_native_password&#x27; WHERE user = &#x27;root&#x27;; </span><br><span class="line">flush privileges; </span><br><span class="line">exit </span><br></pre></td></tr></table></figure>

<p>然后重启服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mariadb </span><br></pre></td></tr></table></figure>

<p>之后再新建wordpress的数据库，首先命令行运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>接着输入之前设置的数据库密码（password），进入后创建新数据库，注意后面的分号，数据库名也可自行设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database wordpress;</span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-223839.jpg"></p>
<p>接着把数据库权限交给root用户,password为数据库密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON wordpress.* TO &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br></pre></td></tr></table></figure>

<p>还需要刷新数据库权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-225128.jpg"></p>
<p>安装php和mysql的插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install php php-mysql -y</span><br></pre></td></tr></table></figure>

<p>之后进入 /var/www/html目录，删掉index.html文件，再新建一个index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br><span class="line">sudo rm index.html</span><br><span class="line">sudo nano index.php</span><br></pre></td></tr></table></figure>

<p>在index.php文件中写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-161433.jpg"></p>
<p>按ctrl+O，再回车，再ctrl+x退出。完成后浏览器刷新页面，页面变成下面这样</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-161520-1024x481.jpg"></p>
<p>这样拍黄片 php就装好了，下面部署wordpress。下载安装包然后解压到/var/www/html目录，由于你懂的原因，直接用树莓派下载太慢，建议用其它设备科学上网下载后再传到树莓派，这里用的是FileZilla，注意需要给文件夹权限否则传输失败，注意主机前的sftp://不可丢</p>
<p>添加权限命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chomd 777 /var/www/html</span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-223358-1024x682.jpg"></p>
<p>完成后浏览器刷新页面，出现下图页面，点击现在开始</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-223535-1024x483.jpg"></p>
<p>数据库名填入之前建立的数据库名，数据库用户名，数据库密码，后面两项不要动，然后提交</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-225245-1024x710.jpg"></p>
<p>后面按照提示设置即可</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-13-225702-1024x481.jpg"></p>
<p>这样基于wordpress的博客就建立好了，这个时候内网可以访问，如果需要外网访问的话自行搜索“内网穿透”</p>
<p>参考链接:<a target="_blank" rel="noopener" href="https://linux.cn/article-10208-1.html">如何在树莓派上搭建 WordPress</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/armcsdn/article/details/100481814">关于在树莓派上不能安装MySql</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/13/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%83%A8%E7%BD%B2wordpress%E5%8D%9A%E5%AE%A2/" data-id="ckr0rt79o0013pct901gk2rst" data-title="树莓派部署Wordpress博客" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-proteus制作元件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/10/proteus%E5%88%B6%E4%BD%9C%E5%85%83%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2020-06-10T02:41:09.000Z" itemprop="datePublished">2020-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/10/proteus%E5%88%B6%E4%BD%9C%E5%85%83%E4%BB%B6/">Proteus制作元件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先，fuck c**n上的复读机</p>
<p>proteus仿真时，在找74ls183芯片时发现，芯片预览左上角提示没有模型，这样的芯片是没法仿真的，仿真直接报错</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-093731-1024x581.jpg"></p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-093820.jpg"></p>
<p>作业指名道姓要用proteus，换软件仿真是不可能的了，只能自己造轮，自己来画了。</p>
<p>首先把元件画出来，当然，库里有的但是没有仿真模型的可以跳过这一步。</p>
<p>首先是二维绘图模式画出元件形状，见1。之后在管脚模式添加管脚，和AD一样注意十字对外，引脚有普通引脚(DEFAULT)、低电平有效引脚(INVERT)、上升沿有效的时钟输入引脚(POSCLK)、下降沿有效的时钟输入引脚(NEGCLK)、短引脚(SHORT)、总线(BUS)等6种形式，放上引脚后注意设置</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-101540.jpg"></p>
<p>注意设置管脚属性，1：管脚名；2：管脚标号；3管脚是否隐藏，取消勾选隐藏，默认勾选；4选择引脚属性</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-102644.jpg"></p>
<p>接下来就是元件入库，大方框覆盖整个绘画的元件，右击选择制作元件，如果是库里面直接拖出来的直接右击元件-&gt;制作元件，后方步骤两者完全一样</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-103140.jpg"></p>
<p>设置元件名和标号前缀，然后下一步</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-103428.jpg"></p>
<p>选择封装，随便选吧，反正我也不画pcb</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-103639.jpg"></p>
<p>然后新建，选择MODEFILE，之后一路下一步，完成。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-103819.jpg"></p>
<p>将上一步制作好的元件，右击编辑属性，勾选下方附加层次，然后确定即可。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-095427.jpg"></p>
<p>这时候再右击元件就会有进入子图选项，右击进入，然后画出内部电路，注意输入输出的引脚为终端的input output，<strong>管脚标号必须与父图一样</strong>，如果元件有隐藏的电源脚需加上电源。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-100138-1024x592.jpg"></p>
<p>然后右击选中退出到父图</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-100358.jpg"></p>
<p>这时候可以仿真测试元件功能了</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/06/%E6%89%B9%E6%B3%A8-2020-06-10-100603.jpg"></p>
<p>此时可以直接复制粘贴使用，忽略下方步骤</p>
<p>……………………..懒得写了，有空再补</p>
<p>参考:<a target="_blank" rel="noopener" href="http://www.dwenzhao.cn/profession/proteus/proteus2.html">PROTEUS的元器件及模型制作</a></p>
<p>芯片内核由༺雨月·听枫༻ ꧂绘制</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/10/proteus%E5%88%B6%E4%BD%9C%E5%85%83%E4%BB%B6/" data-id="ckr0rt799000jpct92lgl8y1o" data-title="Proteus制作元件" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ds18b20管脚该怎么看？" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/08/ds18b20%E7%AE%A1%E8%84%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/" class="article-date">
  <time class="dt-published" datetime="2020-05-08T15:19:19.000Z" itemprop="datePublished">2020-05-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/08/ds18b20%E7%AE%A1%E8%84%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/">DS18B20管脚该怎么看？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一说测温模块，首先想到的就是大名鼎鼎的DS18B20，只需两根电源线和一根信号线就行，芯片主要有三种封装：三条腿的TO-92、六腿的TSOC、八条腿的SOIC-8_150mil。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-08-230032.jpg"></p>
<p>主要的三种封装</p>
<p>后面两种好说，问题在于TO-92，自己焊万用板或PCB库时就要区分引脚，DQ在中间不用说，but，到底哪个是VCC？哪个是GND？</p>
<p>这还不简单？看图说话，曲面对着自己，从左到右依次GND、DQ、VCC。于是我便烧了个18B20祭天了……….</p>
<p>难道datasheet里是错的？紧接着我瞅到了这么个单词</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-08-230032-1.jpg"></p>
<p>底部视角……</p>
<p>特么图就不能画成下面这样的吗？</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/TO-92_Front_with_Pin_Numbers.svg/248px-TO-92_Front_with_Pin_Numbers.svg.png"></p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/TO-92_Back_with_Pin_Numbers.svg/248px-TO-92_Back_with_Pin_Numbers.svg.png"></p>
<p>图片来源：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/TO-92">TO-92-Wikipedia</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/05/08/ds18b20%E7%AE%A1%E8%84%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/" data-id="ckr0rt792000bpct97rx1fcs3" data-title="DS18B20管脚该怎么看？" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-树莓派开箱配置" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/04/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E7%AE%B1%E9%85%8D%E7%BD%AE/" class="article-date">
  <time class="dt-published" datetime="2020-05-04T08:35:04.000Z" itemprop="datePublished">2020-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/raspberry/">raspberry</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/04/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E7%AE%B1%E9%85%8D%E7%BD%AE/">树莓派开箱配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="先点亮再说"><a href="#先点亮再说" class="headerlink" title="先点亮再说"></a>先点亮再说</h2><p>首先需要给树莓派装系统，需要系统镜像和镜像烧录工具。<a target="_blank" rel="noopener" href="https://www.raspberrypi.org/downloads/raspbian/">官方镜像下载</a>，官方提供了三个版本的镜像：无桌面版（Lite）、桌面版和全家桶版（逃 版本按需选择。镜像烧录工具我选<a target="_blank" rel="noopener" href="https://www.balena.io/etcher/">Etcher</a>,其它的也行</p>
<p>打开Etcher，选择好镜像和磁盘然后点Flash！烧写开始，注意中间弹出的格式化叉掉，否则导致镜像烧入失败</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-134415.jpg"></p>
<p>烧写</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-134331.jpg"></p>
<p>烧写完成</p>
<p>有屏幕的同学可以直接把tf卡插上树莓派开机了。当然，穷逼我没有屏幕， 只能用ssh代替了，打开tf卡，在boot目录新建文本文件，重命名为ssh（删除文件拓展名，无法修改文件拓展名的请在文件管理中设置显示拓展名）</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-145638.jpg"></p>
<p>然后把TF卡插入树莓派，用网线连接路由器，擦腚，楷机，轻松点亮。这时候可以在路由器的管理页面看到树莓派的内网地址了。接下来需要用到ssh连接的工具，我用的是<a target="_blank" rel="noopener" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">putty</a>，输入ip地址连接。</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-150709.jpg"></p>
<p>在弹出的弹窗选择是，输入账号密码登陆(LINUX环境下不显示密码，但是可以回车删除等操作)默认账号：pi 密码：raspberry</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-151125.jpg"></p>
<p>登陆成功</p>
<h2 id="接下来就开始树莓派的配置了"><a href="#接下来就开始树莓派的配置了" class="headerlink" title="接下来就开始树莓派的配置了"></a>接下来就开始树莓派的配置了</h2><p>首先换源，由于某些你懂的原因，国外源又慢又容易断，所以换成国内的镜像源。在换源之前一定要确认系统版本，镜像下载的时候会有说明，没注意也不要紧，键入下面的命令查看系统信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a </span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-152010.jpg"></p>
<p>比如这里是buster，之前很多教程是stretch，导致换源失败，然后输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p>在第一行开头加一个<code>#</code>，把源拷贝到最后一行之后（这里用清华源，<strong>注意中间的系统版本</strong>），如图中的效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-152448.jpg"></p>
<p>先按键盘上的<code>ctrl</code>+<code>o</code>，再按回车保存，再按<code>ctrl</code>+<code>x</code>退出nano编辑器回到命令行界面。再输入以下命令更新到清华大学镜像源最新的软件列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update </span><br></pre></td></tr></table></figure>

<p>更新好后给pip换源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir ~/.pip</span><br><span class="line">ls .pip</span><br><span class="line">sudo nano pip.conf</span><br></pre></td></tr></table></figure>

<p>在打开的文件中输入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">timeout = 10</span><br><span class="line">index-url =  http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">extra-index-url= http://pypi.douban.com/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host=</span><br><span class="line">    mirrors.aliyun.com</span><br><span class="line">    pypi.douban.com</span><br></pre></td></tr></table></figure>

<p>先按键盘上的<code>ctrl</code>+<code>o</code>，再按回车保存，再按<code>ctrl</code>+<code>x</code>退出nano编辑器回到命令行界面。</p>
<h2 id="接下来是树莓派内部设置"><a href="#接下来是树莓派内部设置" class="headerlink" title="接下来是树莓派内部设置"></a>接下来是树莓派内部设置</h2><p>输入下列命令进入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo raspi-config</span><br></pre></td></tr></table></figure>

<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-160427.jpg"></p>
<p>第一行是修改密码，不解释 主要第四行修改地区，回车进入</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-160635.jpg"></p>
<p>Localisation Options</p>
<p>第一行：Change Locale 选择所在国家，让光标指在zh_CN.UTF-8 UTF-8前面（最下面），先按空格，再按回车，然后到如下界面，选zh_CN.UTF-8回车</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-161006.jpg"></p>
<p>再设置第二项：地区 时区选择亚洲 上海</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-161236.jpg"></p>
<p>最后设置wifi地区为CN＿China</p>
<p>接着到第五大项 Interfacing Options</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-161534.jpg"></p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-161615.jpg"></p>
<p>按需要打开，比如需要远程图形界面的打开vnc。回到主界面选择下方的finsh，如果问是否需要重启，不需要，还没设置完呢</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/05/%E6%89%B9%E6%B3%A8-2020-05-04-161843.jpg"></p>
<p>安装中文字体和中文输入法fcitx及Google拼音输入法，注意中途会问你，直接输入y回车</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install fonts-wqy-zenhei</span><br><span class="line">sudo apt-get install fcitx fcitx-googlepinyin fcitx-module-cloudpinyin fcitx-sunpinyin</span><br></pre></td></tr></table></figure>

<p>完成后重启，这样就配置完成了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/">清华源</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/TommyZihao/Zihao-Blog/blob/master/02%E4%B8%80%E5%8A%B3%E6%B0%B8%E9%80%B8%E9%85%8D%E7%BD%AE%E6%A0%91%E8%8E%93%E6%B4%BE.md">一劳永逸配置树莓派</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zqxdsy/article/details/102574239">树莓派4B换清华源并更换系统源（Raspbian-buster系统）</a></p>
<p><a target="_blank" rel="noopener" href="https://shumeipai.nxez.com/2013/09/07/using-putty-to-log-in-to-the-raspberry-pie.html">使用PuTTY登录到树莓派</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/05/04/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E7%AE%B1%E9%85%8D%E7%BD%AE/" data-id="ckr0rt79l0010pct900cc6xei" data-title="树莓派开箱配置" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stm32连接到阿里云-mqtt协议移植" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/02/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE%E7%A7%BB%E6%A4%8D/" class="article-date">
  <time class="dt-published" datetime="2020-05-02T10:24:21.000Z" itemprop="datePublished">2020-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/stm32/">stm32</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/02/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE%E7%A7%BB%E6%A4%8D/">stm32连接到阿里云——MQTT协议移植</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>  首先勾选MQTTPacket以将包添加至工程 （没有安装的-&gt;<a target="_blank" rel="noopener" href="https://www.keil.com/dd2/pack/#/third-party-download-dialog">MDK拓展包下载</a>)<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-230527.jpg"> 接下来需要封装四个函数 (我用ESP8266实现TCP连接，请酌情更改)：</p>
<p><code>int</code> <code>transport_sendPacketBuffer(unsigned</code> <code>char``* buf,</code> <code>int</code> <code>buflen);</code></p>
<p>TCP协议发送数据<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-231522.jpg"></p>
<p><code>int</code> <code>transport_getdata(unsigned</code> <code>char``* buf,</code> <code>int</code> <code>count);</code></p>
<p>获取TCP接收到的数据（如果不用分析接收到的数据可以不管）</p>
<p><code>int</code> <code>transport_open(``void``);</code></p>
<p>打开网络接口（建立一个TCP连接）</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-232313-1024x296.jpg"></p>
<p><code>int</code> <code>transport_close(``void``);</code></p>
<p>关闭网络接口</p>
<p>接下来就是这些函数调用了，库中调用的函数都在MQTTPacket.h文件中</p>
<p>构造连接报文发送函数<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-233203.jpg"></p>
<p>构造订阅函数<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-233316-1024x330.jpg"></p>
<p>消息发布函数<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-233401-1024x282.jpg"></p>
<p>接下来在你的主函数中调用这些函数：连接到服务器-&gt;发送连接报文-&gt;订阅-&gt;……</p>
<p>此时可以看看阿里云物联网控制台有没有显示产品在线，不在线请检查上述步骤</p>
<p>MCU和云连接已经完成了，接下来就是数据收发</p>
<p>首先需要在云端建立显示的数据模型</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-234121-1024x334.jpg"></p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-234321.jpg">注意读写类型选择读写，选择只读的话后面没法让云端下发设置该数据</p>
<p>接下来就是单片机调用消息发布函数向属性上报topic发消息（如果没有说明产品建的就不对，重新建产品）</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-18-234631-1024x241.jpg"></p>
<p>发送：{“method”:”thing.event.property.post”,”id”:”demo”,”params”:{“temperature”:36},”version”:”1.0.0”}</p>
<p>主要修改id和后面的标识符和标识符对应的数据。发完之后便可在云端看到数据状态（图后面补）</p>
<p>如果想修改发送内容可以使用cjson的方式创建json，当然也可以用sprintf()构造这个字符串。</p>
<p>接下来是数据下发，首先需要订阅属性设置topic，</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/05/02/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE%E7%A7%BB%E6%A4%8D/" data-id="ckr0rt79h000tpct9gi8d7tme" data-title="stm32连接到阿里云——MQTT协议移植" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stm32连接到阿里云-mqtt协议" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/12/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE/" class="article-date">
  <time class="dt-published" datetime="2020-04-12T07:43:48.000Z" itemprop="datePublished">2020-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/stm32/">stm32</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/12/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE/">stm32连接到阿里云——MQTT协议</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>阿里云物联网平台与单片机通信采用MQTT协议（阿里云兼容MQTT3.1和MQTT3.1.0），什么是MQTT协议？MQTT是一种基于发布/订阅（publish/subscribe）模式的”轻量级”的应用层协议，该协议构建于TCP/IP协议上（类似HTTP），所以在MQTT通信之前需要建立TCP连接。 一个数据包包括包头，可变包头和负载三个部分（部分报文没有可变和负载部分，如ping，disconnect）。 <strong>包头</strong>由固定包头字节和剩余长度组成，其中固定包头字节的高四位表示控制包类型，低四位表示每个MQTT控制包类型的特殊标识，如连接报文（connect）的包头固定字节为0x10。 <img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-140213-1024x529.jpg"><img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-140443-1024x588.jpg"> 从第二个字节开始就是数据包长度，指可变包头和负载的长度。注意包长度所占的字节数没有指定，也就是说长度可以占一个字节，两个，甚至更多。那么怎么知道长度到哪结束呢？数据包长度的每个字节最高位代表是否进位，剩下七位才代表长度，如果最高位置一则说明下个字节还是包长度部分，若下一个字节的最高位也为一则下下个字节还是长度……依此类推。其中下个字节所表示的数据是上一个字节的127倍，假设数据包长度为200，200&gt;127,所以第一个字节放不下，但两个字节可以放下，第一个字节的数据则是（(200%127)0x80）即0xc9，第二个字节为200/127，即0x01，所以包长度表示为0xc9，0x01；<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-142653-1024x182.jpg"> <strong>可变包头</strong>由协议名称，协议版本，连接标识，保持连接时间按顺序构成 <img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-152640-1024x523.jpg"> 其中协议名称由Length MSB，Length LSB和utf-8编码的”MQTT”字符串组成，这样协议名称部分就表示为0x00,0x04,0x4d,0x51,0x54,0x54<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-144024-1024x292.jpg"> 版本占一个字节，MQTT3.1.1为4，即0x04 <img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-144752-1024x156.jpg"> 连接标识<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-150603-1024x148.jpg"> 最低位保留 Clean Session：服务器和客户端断开后是否清除数据，为1时自动删除数据 Will Flag：如果Will Flag被设置为1，这意味着，如果连接请求被接受，服务端必须存储一个Will Message，并和网络连接关联起来。之后在网络连接断开的时候必须发布Will Message，除非服务端收到DISCONNECT包删掉了Will Message Will QoS：消息质量等级，0：只发一次；1：至少发一次；2：发且仅发一次。阿里云暂时只支持0和1 Will Retain：表示Will Message在发布之后是否需要保留。如果Will Flag设置为0，那么Will Retain必须是0。 Password Flag：负载中是否包括密码，置一。 User Name Flag：负载里是否包括用户名，直接置一。 这里连接标识我们设置为0xc2。 保持连接时间<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-12-152311-1024x149.jpg"> 表示客户端从发送完成一个控制包到开始发送下一个的最大时间间隔，单位为秒，两个字节长度。例如设置100秒即0x00，0x64。 这样可变包头部分配置完成。 <strong>最后负载部分</strong> 即数据包传输的数据部分，以连接阿里云connect为例，首先是客户端标识（ClientId）长度和客户端标识，注意长度占两个字节。上一步的连接标识里我们使能了User Name Flag和Password Flag两个标识，所以剩下的内容便是用户名长度(2B)+用户名+密码长度(2B)+密码。 关于客户端标识、用户名、密码等的介绍参考:<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/86706.html">使用MQTT.fx接入物联网平台</a> 建议先使用MQTT.fx软件先将这些参数确定，防止直接在单片机上跑找不到错误原因。 MQTT协议参考：<a target="_blank" rel="noopener" href="http://mqtt.p2hp.com/mqtt311">MQTT Version 3.1.1</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/12/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE/" data-id="ckr0rt79g000rpct9b40ga0vb" data-title="stm32连接到阿里云——MQTT协议" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stm32连接到阿里云-阿里云设备创建" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/12/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-%E9%98%BF%E9%87%8C%E4%BA%91%E8%AE%BE%E5%A4%87%E5%88%9B%E5%BB%BA/" class="article-date">
  <time class="dt-published" datetime="2020-04-11T16:11:50.000Z" itemprop="datePublished">2020-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/stm32/">stm32</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/12/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-%E9%98%BF%E9%87%8C%E4%BA%91%E8%AE%BE%E5%A4%87%E5%88%9B%E5%BB%BA/">stm32连接到阿里云——阿里云设备创建</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先登陆（没有？注册一个，反正不要钱）阿里云物联网控制台，然后创建产品（产品-&gt;创建产品） <img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%97%A0%E6%A0%87%E9%A2%98-300x242.png"></p>
<p>名称任意，品类建议选择自定义，节点类型选直连，网络选择蜂窝，数据格式一定要选择JSON其它默认即可</p>
<p><img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-11-234435-231x300.jpg">接着添加设备，名称任意，完成后进入设备查看，可以看到我们建立的demo产品下的demo设备（产品是指某一类的设备的类型，如果需要增删改功能需要修改产品而不是设备），这样我们测试的设备就创建好了。<img src="http://192.168.1.104/wp-content/uploads/2020/04/%E6%89%B9%E6%B3%A8-2020-04-11-235310-300x155.jpg"> 注： 阿里云物联网平台收费：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document/_detail/124250.html?spm=a2c4g.11186623.6.551.f5ed6710RSifJv">https://help.aliyun.com/document\_detail/124250.html?spm=a2c4g.11186623.6.551.f5ed6710RSifJv</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/12/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-%E9%98%BF%E9%87%8C%E4%BA%91%E8%AE%BE%E5%A4%87%E5%88%9B%E5%BB%BA/" data-id="ckr0rt79m0011pct9ejdxg0mn" data-title="stm32连接到阿里云——阿里云设备创建" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-word" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/22/hello-word/" class="article-date">
  <time class="dt-published" datetime="2020-03-22T02:45:46.000Z" itemprop="datePublished">2020-03-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/22/hello-word/">Hello Word!</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/22/hello-word/" data-id="ckr0rt795000dpct91a965mzo" data-title="Hello Word!" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; zurück</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/New-World/">New World</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/raspberry/">raspberry</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/stm32/">stm32</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83%E5%8D%95%E7%89%87%E6%9C%BA/">其它单片机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/06/08/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/01/21/rts%E3%80%81dtr%E4%B8%8E%E4%B8%80%E9%94%AE%E4%B8%8B%E8%BD%BD%E7%94%B5%E8%B7%AF/">RTS、DTR与一键下载电路</a>
          </li>
        
          <li>
            <a href="/2021/01/21/%E7%BB%99%E6%A0%91%E8%8E%93%E6%B4%BE%E6%B7%BB%E5%8A%A0%E7%89%A9%E7%90%86%E5%BC%80%E5%85%B3%E6%9C%BA%E6%8C%89%E9%94%AE/">给树莓派添加物理开关机按键</a>
          </li>
        
          <li>
            <a href="/2020/12/21/raspberry-pi-3bcups%E5%AE%9E%E7%8E%B0%E5%85%B1%E4%BA%AB%E6%89%93%E5%8D%B0%E6%9C%BA/">Raspberry PI 3B+CUPS实现共享打印机</a>
          </li>
        
          <li>
            <a href="/2020/12/04/how-to-get-cookies%EF%BC%9F/">how to get cookies？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 HelsingenMersken<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>