<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Welcome To HelsingenMersken</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Welcome To HelsingenMersken">
<meta property="og:url" content="http://blog.arbalest.space/page/2/index.html">
<meta property="og:site_name" content="Welcome To HelsingenMersken">
<meta property="og:locale">
<meta property="article:author" content="HelsingenMersken">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Welcome To HelsingenMersken" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome To HelsingenMersken</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.arbalest.space"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-c语言位移、不同长度赋值操作" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/04/c%E8%AF%AD%E8%A8%80%E4%BD%8D%E7%A7%BB%E3%80%81%E4%B8%8D%E5%90%8C%E9%95%BF%E5%BA%A6%E8%B5%8B%E5%80%BC%E6%93%8D%E4%BD%9C/" class="article-date">
  <time class="dt-published" datetime="2020-10-03T16:34:51.000Z" itemprop="datePublished">2020-10-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/04/c%E8%AF%AD%E8%A8%80%E4%BD%8D%E7%A7%BB%E3%80%81%E4%B8%8D%E5%90%8C%E9%95%BF%E5%BA%A6%E8%B5%8B%E5%80%BC%E6%93%8D%E4%BD%9C/">C语言位移、不同长度赋值操作</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="移位问题"><a href="#移位问题" class="headerlink" title="移位问题"></a>移位问题</h2><p>向下函数传入0x00800000和0x00400000分别返回什么？</p>
<p><img src="http://qiniu.laevatein.tech/202110152251595.png"></p>
<p>这还用想，当然返回原值了。然而实际却是返回了0xff800000和0x00400000</p>
<p>为什么0x00800000会返回0xff800000，而0x00400000返回了原值？</p>
<p>先看程序运行过程，首先temp先左移了八位，变成0x80000000，这是没有问题的，再右移八位后却变成了0xff800000。这是因为c语言对无符号类型数据的移位均为空位补零，但是对于有符号类型的右移却根据最高位决定，最高位为1则补1，反之则补零，所以0x00800000变换为0xff800000，而0x00400000返回原数值，但将数据类型改为无符号时则无此规律。</p>
<h2 id="不同类型赋值问题"><a href="#不同类型赋值问题" class="headerlink" title="不同类型赋值问题"></a>不同类型赋值问题</h2><p>已知cannle为u32，p_Temp为s32 分析下列赋值过程</p>
<p><img src="http://qiniu.laevatein.tech/202110152252589.png"></p>
<p>首先u32和s32长度等长，区别在于最高位是否有符号位，这种赋值二进制数值不变，但是在打印时候按不同类型解析。</p>
<p>其次，将长值赋值给短值，截取低位，然后再赋给短值（即丢弃长值中高于短值最高位的所有值）</p>
<p>其实上述过程只是将int 32类型拆分开存储。发送给上位机后，上位机可将其视为一个int32数据。</p>
<h2 id="赋值类型补充"><a href="#赋值类型补充" class="headerlink" title="赋值类型补充"></a>赋值类型补充</h2><table>
<thead>
<tr>
<th>整数与整数之间</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>短值赋给长值</td>
<td>短整数直接高位补0</td>
</tr>
<tr>
<td>两个无符号数据</td>
<td>短整数符号拓展</td>
</tr>
<tr>
<td>两个有符号类型</td>
<td></td>
</tr>
<tr>
<td>一个有符号，一个无符号</td>
<td>短整数先进行位数拓展，过程保持数为不变，然后按长整数的数据类型解析数据</td>
</tr>
</tbody></table>
<h3 id="整数与浮点数之间"><a href="#整数与浮点数之间" class="headerlink" title="整数与浮点数之间"></a>整数与浮点数之间</h3><p>浮点数转整型</p>
<p>截取整数部分</p>
<p>整型转浮点型</p>
<p>小数部分为零，整数部分不变</p>
<p>double &amp; float</p>
<p>double-&gt;float</p>
<p>丢失数据精度</p>
<p>float-&gt;double</p>
<p>不丢失精度</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/10/04/c%E8%AF%AD%E8%A8%80%E4%BD%8D%E7%A7%BB%E3%80%81%E4%B8%8D%E5%90%8C%E9%95%BF%E5%BA%A6%E8%B5%8B%E5%80%BC%E6%93%8D%E4%BD%9C/" data-id="cl6npf1f9000ah4t9dwye93r0" data-title="C语言位移、不同长度赋值操作" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ikbc-c104加灯" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/03/ikbc-c104%E5%8A%A0%E7%81%AF/" class="article-date">
  <time class="dt-published" datetime="2020-10-03T15:39:50.000Z" itemprop="datePublished">2020-10-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/03/ikbc-c104%E5%8A%A0%E7%81%AF/">IKBC C104加灯</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>之前买的机械键盘没带背光，无奈盲打不熟练，晚上码字经常出错，果断决定加灯</p>
<p>拆开键盘发现C104的PCB上预留了灯位，就是没焊，也没有限流电阻。特么右上角还有四个空轴位，特么不就是F108的阉割版么？接上示波器发现特么居然还有PWM信号输出，买包LED直接焊上就是了</p>
<p><img src="http://qiniu.laevatein.tech/202110152304991.png"></p>
<p>预留灯位</p>
<p><img src="http://qiniu.laevatein.tech/202110152304354.png"></p>
<p>PWM驱动信号</p>
<p>准备材料如下：LED一包(注意正向压降、导通电流)，电池(测试LED)、焊锡、吸锡器、螺丝刀、拔键器、焊锡膏、松香、镊子、斜口钳、烙铁。（其实一半都没用上</p>
<p><img src="http://qiniu.laevatein.tech/202110152305569.png"></p>
<p>工具全家福</p>
<p>注意烙铁选功率较大的或者焊台，敷铜板导热快容易让烙铁温度不够。</p>
<p>拆开，加灯，卡口设计，用卡片撬开。注意焊的时候LED正负极以及引脚短路问题，建议焊一排试一排。</p>
<p><img src="http://qiniu.laevatein.tech/202110152305721.png"></p>
<p>焊完时</p>
<p>焊好装回去就是</p>
<p><img src="http://qiniu.laevatein.tech/202110152305690.png"></p>
<p>装好后效果</p>
<p>背光控制快捷键<br>|Fn+1|全 亮|<br>|—|:—-:|<br>|Fn+2|贪 吃 蛇|<br>|Fn+3|按 下 按 键 点 亮|<br>|Fn+4| 涟 漪 |<br>|Fn+5|两 侧 律 动|<br>|Fn+6|全 键 盘 呼 吸 灯|<br>|Fn+7|高亮Esc Q W E R ↑↓←→|<br>|Fn+8|高 亮 部 分 键|<br>|Fn+↑|亮 度 +|<br>|Fn+↓|亮 度 -|<br>|Fn+←|速 度 +|<br>|Fn+→|速 度 -|</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/10/03/ikbc-c104%E5%8A%A0%E7%81%AF/" data-id="cl6npf1fd000hh4t9c7m88oug" data-title="IKBC C104加灯" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-mlx90614-红外测温模块使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/03/mlx90614-%E7%BA%A2%E5%A4%96%E6%B5%8B%E6%B8%A9%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2020-10-03T06:52:42.000Z" itemprop="datePublished">2020-10-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/03/mlx90614-%E7%BA%A2%E5%A4%96%E6%B5%8B%E6%B8%A9%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/">MLX90614 红外测温模块使用（待续</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>非接触式红外测温模块，贵的一批屌照</p>
<h2 id="管脚定义"><a href="#管脚定义" class="headerlink" title="管脚定义"></a>管脚定义</h2><p><img src="http://qiniu.laevatein.tech/202110152312118.png"></p>
<p>MLX90614管脚定义</p>
<p>就电源线和IIC一共四根线，接线简单。</p>
<h2 id="RAM和EEPROM"><a href="#RAM和EEPROM" class="headerlink" title="RAM和EEPROM"></a>RAM和EEPROM</h2><p>32*16bitEEPROM，部分可写入，所有均可读取。0x04可设置物体发射率</p>
<p><img src="http://qiniu.laevatein.tech/202110152313734.png"></p>
<p>即物理发射率取值四舍五入后最接近物体的值，默认为1(即0xFFFF).写入时需要先清零再写入</p>
<p><img src="http://qiniu.laevatein.tech/202110152313802.png"></p>
<p>32*16bitRAM 部分可读，Ta为环境温度，Tobj1为目标温度，Tobj2在部分型号中不支持，值和Ta一致</p>
<p><img src="http://qiniu.laevatein.tech/202110152313898.png"></p>
<h2 id="温度干扰与补偿"><a href="#温度干扰与补偿" class="headerlink" title="温度干扰与补偿"></a>温度干扰与补偿</h2><p><img src="http://qiniu.laevatein.tech/202110152313000.png"></p>
<p>只有当传感器在热平衡且恒温状态下测得的温度才是准确的，需要注意旁边是否有热源（电路发热、被测物体过近），而我这里使用的MLX90614DCI可以设置内部测量热梯度并补偿测量的温度，降低干扰。(老老实实远离热源</p>
<p>测温的准确性依赖于VDD，VDD对环境温度和物体温度的典型依赖性为0.6°C / V。</p>
<p><img src="http://qiniu.laevatein.tech/202110152314593.png"></p>
<p>Ta对VDD的依赖性（实际To和Ta一致）</p>
<p>由于出厂时校准时VDD=3V，则为了补偿该误差，我们测量电源电压，并通过应用以下公式补偿结果：</p>
<p><img src="http://qiniu.laevatein.tech/202110152314423.png"></p>
<p>测量角度影响测量温度</p>
<p><img src="http://qiniu.laevatein.tech/202110152314678.png"></p>
<p>几种规格的对应视野角度</p>
<p><img src="http://qiniu.laevatein.tech/202110152314045.png"></p>
<p>MLX90614DCI对应视野的角度值与灵敏度</p>
<h2 id="休眠"><a href="#休眠" class="headerlink" title="休眠"></a>休眠</h2><p>可通过设置高低温实现模块的睡眠以节省功耗，计算公式如下</p>
<p><img src="http://qiniu.laevatein.tech/202110152315044.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/10/03/mlx90614-%E7%BA%A2%E5%A4%96%E6%B5%8B%E6%B8%A9%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/" data-id="cl6npf1fg000jh4t9cj524kbf" data-title="MLX90614 红外测温模块使用（待续" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-分析空调遥控器编码" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/01/%E5%88%86%E6%9E%90%E7%A9%BA%E8%B0%83%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81/" class="article-date">
  <time class="dt-published" datetime="2020-08-01T14:26:10.000Z" itemprop="datePublished">2020-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/01/%E5%88%86%E6%9E%90%E7%A9%BA%E8%B0%83%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81/">分析空调遥控器编码</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>上一步中获取了遥控器的红外数据，接下来就需要解析了</p>
<p><img src="http://qiniu.laevatein.tech/202110152328206.jpeg"></p>
<p>观察这126组数据，显然72组数据后的数据电平时钟不变，时间也是满的（9637us）。说明该遥控器数据位共72位。</p>
<h2 id="开机位"><a href="#开机位" class="headerlink" title="开机位"></a>开机位</h2><p>接下来用控制变量法获取数据解析，首先是开关机位。分别获得 制冷 25度 自动风 摆风 下的开关机码。建议将打印出来的数据导入excel分析比较方便。将前后电平时间相减，差值小于100的认为是系统误差，大于的认为是数据差。很明显第9位和65位数据差值大于1000 。二者应该只有一个位控制开关机，剩下一个数据区别应该为检验和区别，正常人都会把校验和放在最后，所以大胆预测第九位控制开关机 ，65位及附近数据为检验位。</p>
<p><img src="http://qiniu.laevatein.tech/202110152329814.jpeg"></p>
<h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><p>上面推算出来了开机位，注意数据格式 大胆猜测 <strong>起始信号</strong>为4100us的高电平和450us左右的低电平组成 数据信号的第二个电平为0 且时间为450us左右 ，而第一个电平为高电平时间为420us或1550us，对应的应该为数据0 和1 （关于这里的推测，联系上面的开机位，正常人都会把开机设为1，关机设为0），这样大致的数据格式推测出来了，可能有错误，继续用控制变量法获取数据分析，有错再改。</p>
<h2 id="温度控制位"><a href="#温度控制位" class="headerlink" title="温度控制位"></a>温度控制位</h2><p>分别采集 开机 制冷 自动风 摆风 前提下 25度和26度的数据，发现有15 16两位 30 31位 以及65位前后不一样，首先可以肯定的是上面的开关机位推断正确，但是仍然看不出来温度变化规律。</p>
<p><img src="http://qiniu.laevatein.tech/202110152329222.jpeg"></p>
<p>25和26对比</p>
<p>大胆一点，干脆把温度调到最低看，特么的，怎么还是那三处不一样。没办法，只能带进去假设演算了。18度和25度第一个区别就是13 15 16 不一样，将数据按上一步推测的换成0或1，可得18度时为0010，25度为1001. 加减一下可以发现：25-18==7==1001-0010 ；这样规律很可能是 temperature - 18 = n - 0010 将26度的数据带入演算，推断成立。该遥控器支持最大温度为32度，哎，四位数最多到31，需要5bit。大胆再猜下12-16 5bit都是控制温度的，32度时为10000. 控制变量将温度设置为32度，发现上述推断成立。</p>
<p>注意28-32位数据和温度有关，但是没看出来具体关联，可能是某类校验，先跳过</p>
<p><img src="http://qiniu.laevatein.tech/202110152329356.jpeg"></p>
<p>18和25度对比</p>
<h2 id="模式控制位"><a href="#模式控制位" class="headerlink" title="模式控制位"></a>模式控制位</h2><p>直接将上述模式切换为送风模式，发现只有2-16bit 上数据为00001有不同，特么怎么又跑到温控位了？但是18度时为00010，下面确实有一位没用，可能送风模式比较特殊，直接用温控位代替了。</p>
<p>继续分析其他模式，将模式切换为制热模式，发现这次变的地方太多了，等下再继续分析模式</p>
<h2 id="风速控制位"><a href="#风速控制位" class="headerlink" title="风速控制位"></a>风速控制位</h2><p>分别获取 自动模式 24 不扫风下的强中低三种风速</p>
<p><img src="http://qiniu.laevatein.tech/202110152329625.jpeg"></p>
<p>发现55 56两位区别，弱风为01 中为10 强风为11 该遥控器还有一个自动风，应该为00，将00带入之前开机位测试的码型中，结论成立。</p>
<h2 id="摆风控制"><a href="#摆风控制" class="headerlink" title="摆风控制"></a>摆风控制</h2><p>同理可得41位控制摆风</p>
<p><img src="http://qiniu.laevatein.tech/202110152330492.jpeg"></p>
<h2 id="风向控制"><a href="#风向控制" class="headerlink" title="风向控制"></a>风向控制</h2><p>45位为方向控制位，该位使能后摆风失能，导风板切换方向一次</p>
<p><img src="http://qiniu.laevatein.tech/202110152330452.jpeg"></p>
<h2 id="起始码和地址码"><a href="#起始码和地址码" class="headerlink" title="起始码和地址码"></a>起始码和地址码</h2><p>经过上述分析过程，堆积样本码数量足够多了，仔细观察前九位，数据完全一样。第一位格式较特殊，起始码推断应该没问题。再往后八位：01010101，数据完全一样，推断大概率可能为地址码</p>
<p><img src="http://qiniu.laevatein.tech/202110152330932.jpeg"></p>
<h2 id="数显控制位"><a href="#数显控制位" class="headerlink" title="数显控制位"></a>数显控制位</h2><p>46-48为数显控制位，000保持当前 111切换状态</p>
<p><img src="http://qiniu.laevatein.tech/202110152330152.jpeg"></p>
<h2 id="超静控制位"><a href="#超静控制位" class="headerlink" title="超静控制位"></a>超静控制位</h2><p>62位为超静控制位，1：使能超静模式</p>
<p><img src="http://qiniu.laevatein.tech/202110152330605.jpeg"></p>
<h2 id="定时控制位"><a href="#定时控制位" class="headerlink" title="定时控制位"></a>定时控制位</h2><p>多次采集对比发现 11 36-40 57 58都和时间有关联</p>
<p>11位较为明显，控制定时功能是否开启，为1时开启</p>
<p>36-40位控制定时时间，此部分较为特殊，当t&lt;=5h时，该部分值为2t。当t&gt;5 h时，数据为1010+（t-5h）。</p>
<p>57 58两位控制定时状态 ，具体不清楚</p>
<p>该功能用不上，定时时间选择太小，还不如用单片机定时器直接定时方便（逃</p>
<h2 id="模式控制位-1"><a href="#模式控制位-1" class="headerlink" title="模式控制位"></a>模式控制位</h2><p>前面已经分析一半多的码了，继续分析模式，依次切换模式尝试（自动、送风模式下温度无法控制，分析时排出温度位和温度相关位（12-16，28-32））</p>
<p><img src="http://qiniu.laevatein.tech/202110152331615.jpeg"></p>
<p>50-52位控制模式，自动(000)-&gt;制冷(001)-&gt;除湿(010)-&gt;送风(011)-&gt;制热(100).</p>
<p>值得注意的是，此时送风模式下得到的温度值是24(01000),这和之前温度分析不一样？？？然后我去翻了之前保留的数据，发现温度值是24，而不是之前写的00001？？？</p>
<h2 id="睡眠控制位"><a href="#睡眠控制位" class="headerlink" title="睡眠控制位"></a>睡眠控制位</h2><p>19位为睡眠控制位，为1使能睡眠功能</p>
<p>先睡觉，起来再写，狗命要紧</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/08/01/%E5%88%86%E6%9E%90%E7%A9%BA%E8%B0%83%E9%81%A5%E6%8E%A7%E5%99%A8%E7%BC%96%E7%A0%81/" data-id="cl6npf1fr000zh4t9ez4hd5xt" data-title="分析空调遥控器编码" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-esp32配置rmt" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/07/16/esp32%E9%85%8D%E7%BD%AErmt/" class="article-date">
  <time class="dt-published" datetime="2020-07-16T13:22:41.000Z" itemprop="datePublished">2020-07-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/16/esp32%E9%85%8D%E7%BD%AErmt/">ESP32配置RMT接收功能</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>懒癌晚期，一个月没更了（逃</p>
<h2 id="一-什么是RMT？能干啥？"><a href="#一-什么是RMT？能干啥？" class="headerlink" title="一 什么是RMT？能干啥？"></a>一 什么是RMT？能干啥？</h2><p>RMT(Remote Control)即红外遥控，通过红外传输数据。学单片机的时候，不管是51还是stm32，肯定有个红外遥控。而且做得都是接收数据解析，想要控制空调之类的家电要干的事居多</p>
<h2 id="二-首先是怎么通过红外传输数据"><a href="#二-首先是怎么通过红外传输数据" class="headerlink" title="二 首先是怎么通过红外传输数据"></a>二 首先是怎么通过红外传输数据</h2><p>数字信号-&gt;模拟信号-&gt;红外光线-&gt;模拟信号-&gt;数字信号</p>
<p>主要的工作就是把数字信号调制成红外信号再将红外信号解调成数字信号。最简单的当然是直接把灯亮灭当0/1，但是如何排除干扰项呢？显然这是不行的。一般而言，红外传输是先把数据转化为NEC格式的编码或者PPM编码，之后再将数据加载到载波信号（一般为38KHz）上完成调制过程。</p>
<p><img src="http://qiniu.laevatein.tech/202110152303401.png"></p>
<p>调制过程</p>
<h2 id="三-具体的API调用"><a href="#三-具体的API调用" class="headerlink" title="三 具体的API调用"></a>三 具体的API调用</h2><p>信号调制过程可以使用定时器+PWM信号完成，本憨批一开始就是这么做的…后来发现乐鑫的ESP32提供了RMT功能的API：<a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/peripherals/rmt.html#c.RMT_MEM_ITEM_NUM">官方API参考</a></p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>通过初始化结构体 <em>rmt_config_t</em> ，再调用函数_rmt_config(_)和_rmt_driver_install()_完成配置，需要注意的是esp32默认的内存块只能存下63bit的数据，空调这些绝对不是什么省油的灯，需要将mem_block_num设置为2。126应该够大多数场景用了。</p>
<p><img src="http://qiniu.laevatein.tech/202110152301701.jpeg"></p>
<p>红外接收初始化函数</p>
<p>接下来是数据的解析,读取缓存区并将数据打印出来。缓存的数据是保存在rmt_item32_t结构体中 ，该结构体主要成员为level0,duration0,level1,duration1.即两组电平、时间。</p>
<p><img src="http://qiniu.laevatein.tech/202110152301966.jpeg"></p>
<p><img src="http://qiniu.laevatein.tech/202110152302655.jpeg"></p>
<p>打印出来的数据</p>
<p>看到打印出来的数据后需要自行解析了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/07/16/esp32%E9%85%8D%E7%BD%AErmt/" data-id="cl6npf1fb000ch4t92kyy4udb" data-title="ESP32配置RMT接收功能" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-树莓派部署wordpress博客" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/13/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%83%A8%E7%BD%B2wordpress%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time class="dt-published" datetime="2020-06-13T15:05:15.000Z" itemprop="datePublished">2020-06-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/New-World/">New World</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/13/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%83%A8%E7%BD%B2wordpress%E5%8D%9A%E5%AE%A2/">树莓派部署Wordpress博客</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先安装Apache</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2 -y</span><br></pre></td></tr></table></figure>

<p>安装完成可以在localhost打开，如果是无桌面版的，同一局域网的设备直接访问树莓派ip地址。安装成功则可以在浏览器内看到下列内容</p>
<p><img src="http://qiniu.laevatein.tech/202110152335832.jpeg"></p>
<p>接下来是安装数据库，第一个坑来了，很多老教程是装MySQL，不好意思，新树莓派系统木得，需要换成MriaDB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mariadb-server </span><br></pre></td></tr></table></figure>

<p>中间问你装不装，填个y，回车。完成后通过下个命令连接mriaDB</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql </span><br></pre></td></tr></table></figure>

<p>出现下图即为成功连接到MariaDB</p>
<p><img src="http://qiniu.laevatein.tech/202110152335096.jpeg"></p>
<p>接着需要给root用户修改密码（自行替换password）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use mysql; </span><br><span class="line">UPDATE user SET password=password(&#x27;password&#x27;) WHERE user=&#x27;root&#x27;; </span><br><span class="line">UPDATE user SET plugin=&#x27;mysql_native_password&#x27; WHERE user = &#x27;root&#x27;; </span><br><span class="line">flush privileges; </span><br><span class="line">exit </span><br></pre></td></tr></table></figure>

<p>然后重启服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart mariadb </span><br></pre></td></tr></table></figure>

<p>之后再新建wordpress的数据库，首先命令行运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>接着输入之前设置的数据库密码（password），进入后创建新数据库，注意后面的分号，数据库名也可自行设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database wordpress;</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152335720.jpeg"></p>
<p>接着把数据库权限交给root用户,password为数据库密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON wordpress.* TO &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br></pre></td></tr></table></figure>

<p>还需要刷新数据库权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152336564.jpeg"></p>
<p>安装php和mysql的插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install php php-mysql -y</span><br></pre></td></tr></table></figure>

<p>之后进入 /var/www/html目录，删掉index.html文件，再新建一个index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br><span class="line">sudo rm index.html</span><br><span class="line">sudo nano index.php</span><br></pre></td></tr></table></figure>

<p>在index.php文件中写入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152336921.jpeg"></p>
<p>按ctrl+O，再回车，再ctrl+x退出。完成后浏览器刷新页面，页面变成下面这样</p>
<p><img src="http://qiniu.laevatein.tech/202110152336817.jpeg"></p>
<p>这样拍黄片 php就装好了，下面部署wordpress。下载安装包然后解压到/var/www/html目录，由于你懂的原因，直接用树莓派下载太慢，建议用其它设备科学上网下载后再传到树莓派，这里用的是FileZilla，注意需要给文件夹权限否则传输失败，注意主机前的sftp://不可丢</p>
<p>添加权限命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chomd 777 /var/www/html</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152336574.jpeg"></p>
<p>完成后浏览器刷新页面，出现下图页面，点击现在开始</p>
<p><img src="http://qiniu.laevatein.tech/202110152336553.jpeg"></p>
<p>数据库名填入之前建立的数据库名，数据库用户名，数据库密码，后面两项不要动，然后提交</p>
<p><img src="http://qiniu.laevatein.tech/202110152337765.jpeg"></p>
<p>后面按照提示设置即可</p>
<p><img src="http://qiniu.laevatein.tech/202110152337593.jpeg"></p>
<p>这样基于wordpress的博客就建立好了，这个时候内网可以访问，如果需要外网访问的话自行搜索“内网穿透”</p>
<p>参考链接:<a target="_blank" rel="noopener" href="https://linux.cn/article-10208-1.html">如何在树莓派上搭建 WordPress</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/armcsdn/article/details/100481814">关于在树莓派上不能安装MySql</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/06/13/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%83%A8%E7%BD%B2wordpress%E5%8D%9A%E5%AE%A2/" data-id="cl6npf1g20017h4t976xqhtff" data-title="树莓派部署Wordpress博客" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-proteus制作元件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/10/proteus%E5%88%B6%E4%BD%9C%E5%85%83%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2020-06-10T02:41:09.000Z" itemprop="datePublished">2020-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/06/10/proteus%E5%88%B6%E4%BD%9C%E5%85%83%E4%BB%B6/">Proteus制作元件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先，fuck c**n上的复读机</p>
<p>proteus仿真时，在找74ls183芯片时发现，芯片预览左上角提示没有模型，这样的芯片是没法仿真的，仿真直接报错</p>
<p><img src="http://qiniu.laevatein.tech/202110152315732.jpeg"></p>
<p><img src="http://qiniu.laevatein.tech/202110152315797.jpeg"></p>
<p>作业指名道姓要用proteus，换软件仿真是不可能的了，只能自己造轮，自己来画了。</p>
<p>首先把元件画出来，当然，库里有的但是没有仿真模型的可以跳过这一步。</p>
<p>首先是二维绘图模式画出元件形状，见1。之后在管脚模式添加管脚，和AD一样注意十字对外，引脚有普通引脚(DEFAULT)、低电平有效引脚(INVERT)、上升沿有效的时钟输入引脚(POSCLK)、下降沿有效的时钟输入引脚(NEGCLK)、短引脚(SHORT)、总线(BUS)等6种形式，放上引脚后注意设置</p>
<p><img src="http://qiniu.laevatein.tech/202110152316497.jpeg"></p>
<p>注意设置管脚属性，1：管脚名；2：管脚标号；3管脚是否隐藏，取消勾选隐藏，默认勾选；4选择引脚属性</p>
<p><img src="http://qiniu.laevatein.tech/202110152316808.jpeg"></p>
<p>接下来就是元件入库，大方框覆盖整个绘画的元件，右击选择制作元件，如果是库里面直接拖出来的直接右击元件-&gt;制作元件，后方步骤两者完全一样</p>
<p><img src="http://qiniu.laevatein.tech/202110152316109.jpeg"></p>
<p>设置元件名和标号前缀，然后下一步</p>
<p><img src="http://qiniu.laevatein.tech/202110152316971.jpeg"></p>
<p>选择封装，随便选吧，反正我也不画pcb</p>
<p><img src="http://qiniu.laevatein.tech/202110152316859.jpeg"></p>
<p>然后新建，选择MODEFILE，之后一路下一步，完成。</p>
<p><img src="http://qiniu.laevatein.tech/202110152317144.jpeg"></p>
<p>将上一步制作好的元件，右击编辑属性，勾选下方附加层次，然后确定即可。</p>
<p><img src="http://qiniu.laevatein.tech/202110152317827.jpeg"></p>
<p>这时候再右击元件就会有进入子图选项，右击进入，然后画出内部电路，注意输入输出的引脚为终端的input output，<strong>管脚标号必须与父图一样</strong>，如果元件有隐藏的电源脚需加上电源。</p>
<p><img src="http://qiniu.laevatein.tech/202110152317064.jpeg"></p>
<p>然后右击选中退出到父图</p>
<p><img src="http://qiniu.laevatein.tech/202110152317033.jpeg"></p>
<p>这时候可以仿真测试元件功能了</p>
<p><img src="http://qiniu.laevatein.tech/202110152318360.jpeg"></p>
<p>此时可以直接复制粘贴使用，忽略下方步骤</p>
<p>……………………..懒得写了，有空再补</p>
<p>参考:<a target="_blank" rel="noopener" href="http://www.dwenzhao.cn/profession/proteus/proteus2.html">PROTEUS的元器件及模型制作</a></p>
<p>芯片内核由@༺雨月·听枫༻ ꧂绘制</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/06/10/proteus%E5%88%B6%E4%BD%9C%E5%85%83%E4%BB%B6/" data-id="cl6npf1fh000lh4t94oo47m0n" data-title="Proteus制作元件" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ds18b20管脚该怎么看？" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/08/ds18b20%E7%AE%A1%E8%84%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/" class="article-date">
  <time class="dt-published" datetime="2020-05-08T15:19:19.000Z" itemprop="datePublished">2020-05-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/08/ds18b20%E7%AE%A1%E8%84%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/">DS18B20管脚该怎么看？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一说测温模块，首先想到的就是大名鼎鼎的DS18B20，只需两根电源线和一根信号线就行，芯片主要有三种封装：三条腿的TO-92、六腿的TSOC、八条腿的SOIC-8_150mil。</p>
<p><img src="http://qiniu.laevatein.tech/202110152257116.jpeg"></p>
<p>主要的三种封装</p>
<p>后面两种好说，问题在于TO-92，自己焊万用板或PCB库时就要区分引脚，DQ在中间不用说，but，到底哪个是VCC？哪个是GND？</p>
<p>这还不简单？看图说话，曲面对着自己，从左到右依次GND、DQ、VCC。于是我便烧了个18B20祭天了……….</p>
<p>难道datasheet里是错的？紧接着我瞅到了这么个单词</p>
<p><img src="http://qiniu.laevatein.tech/202110152257625.jpeg"></p>
<p>底部视角……</p>
<p>特么图就不能画成下面这样的吗？</p>
<p><img src="http://qiniu.laevatein.tech/202110152259231.png"></p>
<p><img src="http://qiniu.laevatein.tech/202110152259734.png"></p>
<p>图片来源：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/TO-92">TO-92-Wikipedia</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/05/08/ds18b20%E7%AE%A1%E8%84%9A%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/" data-id="cl6npf1fa000bh4t96zfa0x2o" data-title="DS18B20管脚该怎么看？" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-树莓派开箱配置" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/04/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E7%AE%B1%E9%85%8D%E7%BD%AE/" class="article-date">
  <time class="dt-published" datetime="2020-05-04T08:35:04.000Z" itemprop="datePublished">2020-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/raspberry/">raspberry</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/04/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E7%AE%B1%E9%85%8D%E7%BD%AE/">树莓派开箱配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="先点亮再说"><a href="#先点亮再说" class="headerlink" title="先点亮再说"></a>先点亮再说</h2><p>首先需要给树莓派装系统，需要系统镜像和镜像烧录工具。<a target="_blank" rel="noopener" href="https://www.raspberrypi.org/downloads/raspbian/">官方镜像下载</a>，官方提供了三个版本的镜像：无桌面版（Lite）、桌面版和全家桶版（逃 版本按需选择。镜像烧录工具我选<a target="_blank" rel="noopener" href="https://www.balena.io/etcher/">Etcher</a>,其它的也行</p>
<p>打开Etcher，选择好镜像和磁盘然后点Flash！烧写开始，注意中间弹出的格式化叉掉，否则导致镜像烧入失败</p>
<p><img src="http://qiniu.laevatein.tech/202110152338565.jpeg"></p>
<p>烧写</p>
<p><img src="http://qiniu.laevatein.tech/202110152338900.jpeg"></p>
<p>烧写完成</p>
<p>有屏幕的同学可以直接把tf卡插上树莓派开机了。当然，穷逼我没有屏幕， 只能用ssh代替了，打开tf卡，在boot目录新建文本文件，重命名为ssh（删除文件拓展名，无法修改文件拓展名的请在文件管理中设置显示拓展名）</p>
<p><img src="http://qiniu.laevatein.tech/202110152338959.jpeg"></p>
<p>然后把TF卡插入树莓派，用网线连接路由器，擦腚，楷机，轻松点亮。这时候可以在路由器的管理页面看到树莓派的内网地址了。接下来需要用到ssh连接的工具，我用的是<a target="_blank" rel="noopener" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">putty</a>，输入ip地址连接。</p>
<p><img src="http://qiniu.laevatein.tech/202110152338137.jpeg"></p>
<p>在弹出的弹窗选择是，输入账号密码登陆(LINUX环境下不显示密码，但是可以回车删除等操作)默认账号：pi 密码：raspberry</p>
<p><img src="http://qiniu.laevatein.tech/202110152339454.jpeg"></p>
<p>登陆成功</p>
<h2 id="接下来就开始树莓派的配置了"><a href="#接下来就开始树莓派的配置了" class="headerlink" title="接下来就开始树莓派的配置了"></a>接下来就开始树莓派的配置了</h2><p>首先换源，由于某些你懂的原因，国外源又慢又容易断，所以换成国内的镜像源。在换源之前一定要确认系统版本，镜像下载的时候会有说明，没注意也不要紧，键入下面的命令查看系统信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a </span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152339037.jpeg"></p>
<p>比如这里是buster，之前很多教程是stretch，导致换源失败，然后输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p>在第一行开头加一个<code>#</code>，把源拷贝到最后一行之后（这里用清华源，<strong>注意中间的系统版本</strong>），如图中的效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152339393.jpeg"></p>
<p>先按键盘上的<code>ctrl</code>+<code>o</code>，再按回车保存，再按<code>ctrl</code>+<code>x</code>退出nano编辑器回到命令行界面。再输入以下命令更新到清华大学镜像源最新的软件列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update </span><br></pre></td></tr></table></figure>

<p>更新好后给pip换源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir ~/.pip</span><br><span class="line">ls .pip</span><br><span class="line">sudo nano pip.conf</span><br></pre></td></tr></table></figure>

<p>在打开的文件中输入以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">timeout = 10</span><br><span class="line">index-url =  http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">extra-index-url= http://pypi.douban.com/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host=</span><br><span class="line">    mirrors.aliyun.com</span><br><span class="line">    pypi.douban.com</span><br></pre></td></tr></table></figure>

<p>先按键盘上的<code>ctrl</code>+<code>o</code>，再按回车保存，再按<code>ctrl</code>+<code>x</code>退出nano编辑器回到命令行界面。</p>
<h2 id="接下来是树莓派内部设置"><a href="#接下来是树莓派内部设置" class="headerlink" title="接下来是树莓派内部设置"></a>接下来是树莓派内部设置</h2><p>输入下列命令进入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo raspi-config</span><br></pre></td></tr></table></figure>

<p><img src="http://qiniu.laevatein.tech/202110152339205.jpeg"></p>
<p>第一行是修改密码，不解释 主要第四行修改地区，回车进入</p>
<p><img src="http://qiniu.laevatein.tech/202110152340830.jpeg"></p>
<p>Localisation Options</p>
<p>第一行：Change Locale 选择所在国家，让光标指在zh_CN.UTF-8 UTF-8前面（最下面），先按空格，再按回车，然后到如下界面，选zh_CN.UTF-8回车</p>
<p><img src="http://qiniu.laevatein.tech/202110152340029.jpeg"></p>
<p>再设置第二项：地区 时区选择亚洲 上海</p>
<p><img src="http://qiniu.laevatein.tech/202110152340688.jpeg"></p>
<p>最后设置wifi地区为CN＿China</p>
<p>接着到第五大项 Interfacing Options</p>
<p><img src="http://qiniu.laevatein.tech/202110152340555.jpeg"></p>
<p><img src="http://qiniu.laevatein.tech/202110152340027.jpeg"></p>
<p>按需要打开，比如需要远程图形界面的打开vnc。回到主界面选择下方的finsh，如果问是否需要重启，不需要，还没设置完呢</p>
<p><img src="http://qiniu.laevatein.tech/202110152341460.jpeg"></p>
<p>安装中文字体和中文输入法fcitx及Google拼音输入法，注意中途会问你，直接输入y回车</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install fonts-wqy-zenhei</span><br><span class="line">sudo apt-get install fcitx fcitx-googlepinyin fcitx-module-cloudpinyin fcitx-sunpinyin</span><br></pre></td></tr></table></figure>

<p>完成后重启，这样就配置完成了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/raspbian/">清华源</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/TommyZihao/Zihao-Blog/blob/master/02%E4%B8%80%E5%8A%B3%E6%B0%B8%E9%80%B8%E9%85%8D%E7%BD%AE%E6%A0%91%E8%8E%93%E6%B4%BE.md">一劳永逸配置树莓派</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zqxdsy/article/details/102574239">树莓派4B换清华源并更换系统源（Raspbian-buster系统）</a></p>
<p><a target="_blank" rel="noopener" href="https://shumeipai.nxez.com/2013/09/07/using-putty-to-log-in-to-the-raspberry-pie.html">使用PuTTY登录到树莓派</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/05/04/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E7%AE%B1%E9%85%8D%E7%BD%AE/" data-id="cl6npf1g00015h4t9a2sy53ir" data-title="树莓派开箱配置" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-stm32连接到阿里云-mqtt协议移植" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/02/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE%E7%A7%BB%E6%A4%8D/" class="article-date">
  <time class="dt-published" datetime="2020-05-02T10:24:21.000Z" itemprop="datePublished">2020-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/stm32/">stm32</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/02/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE%E7%A7%BB%E6%A4%8D/">stm32连接到阿里云——MQTT协议移植</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>  首先勾选MQTTPacket以将包添加至工程 （没有安装的-&gt;<a target="_blank" rel="noopener" href="https://www.keil.com/dd2/pack/#/third-party-download-dialog">MDK拓展包下载</a>)<br><img src="http://qiniu.laevatein.tech/202110152327946.jpeg"> 接下来需要封装四个函数 (我用ESP8266实现TCP连接，请酌情更改)：</p>
<p><code>int</code> <code>transport_sendPacketBuffer(unsigned</code> <code>char``* buf,</code> <code>int</code> <code>buflen);</code></p>
<p>TCP协议发送数据<img src="http://qiniu.laevatein.tech/202110152327943.jpeg"></p>
<p><code>int</code> <code>transport_getdata(unsigned</code> <code>char``* buf,</code> <code>int</code> <code>count);</code></p>
<p>获取TCP接收到的数据（如果不用分析接收到的数据可以不管）</p>
<p><code>int</code> <code>transport_open(``void``);</code></p>
<p>打开网络接口（建立一个TCP连接）</p>
<p><img src="http://qiniu.laevatein.tech/202110152328542.jpeg"></p>
<p><code>int</code> <code>transport_close(``void``);</code></p>
<p>关闭网络接口</p>
<p>接下来就是这些函数调用了，库中调用的函数都在MQTTPacket.h文件中</p>
<p>构造连接报文发送函数<img src="http://qiniu.laevatein.tech/202110152325429.jpeg"></p>
<p>构造订阅函数<img src="http://qiniu.laevatein.tech/202110152326143.jpeg"></p>
<p>消息发布函数<img src="http://qiniu.laevatein.tech/202110152326668.jpeg"></p>
<p>接下来在你的主函数中调用这些函数：连接到服务器-&gt;发送连接报文-&gt;订阅-&gt;……</p>
<p>此时可以看看阿里云物联网控制台有没有显示产品在线，不在线请检查上述步骤</p>
<p>MCU和云连接已经完成了，接下来就是数据收发</p>
<p>首先需要在云端建立显示的数据模型</p>
<p><img src="http://qiniu.laevatein.tech/202110152326054.jpeg"></p>
<p><img src="http://qiniu.laevatein.tech/202110152326600.jpeg">注意读写类型选择读写，选择只读的话后面没法让云端下发设置该数据</p>
<p>接下来就是单片机调用消息发布函数向属性上报topic发消息（如果没有说明产品建的就不对，重新建产品）</p>
<p><img src="http://qiniu.laevatein.tech/202110152326522.jpeg"></p>
<p>发送：{“method”:”thing.event.property.post”,”id”:”demo”,”params”:{“temperature”:36},”version”:”1.0.0”}</p>
<p>主要修改id和后面的标识符和标识符对应的数据。发完之后便可在云端看到数据状态（图后面补）</p>
<p>如果想修改发送内容可以使用cjson的方式创建json，当然也可以用sprintf()构造这个字符串。</p>
<p>接下来是数据下发，首先需要订阅属性设置topic，</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.arbalest.space/2020/05/02/stm32%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91-mqtt%E5%8D%8F%E8%AE%AE%E7%A7%BB%E6%A4%8D/" data-id="cl6npf1fp000uh4t98pca02yq" data-title="stm32连接到阿里云——MQTT协议移植" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; zurück</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/New-World/">New World</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/raspberry/">raspberry</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/stm32/">stm32</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83%E5%8D%95%E7%89%87%E6%9C%BA/">其它单片机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">踩坑记录</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/12/31/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/">2021年终总结</a>
          </li>
        
          <li>
            <a href="/2021/10/13/%E5%91%8A%E5%88%ABVM%E8%99%9A%E6%8B%9F%E6%9C%BA%EF%BC%8C%E4%BD%BF%E7%94%A8WSL%E5%AE%89%E8%A3%85%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%99%A8/">告别VM虚拟机，使用WSL安装交叉编译器</a>
          </li>
        
          <li>
            <a href="/2021/09/30/Makefile/">Makefile</a>
          </li>
        
          <li>
            <a href="/2021/09/22/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8B%E5%B2%97%E5%86%8D%E5%B0%B1%E4%B8%9A-ZeroTier%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/">树莓派下岗再就业-ZeroTier内网穿透</a>
          </li>
        
          <li>
            <a href="/2021/01/21/rts%E3%80%81dtr%E4%B8%8E%E4%B8%80%E9%94%AE%E4%B8%8B%E8%BD%BD%E7%94%B5%E8%B7%AF/">RTS、DTR与一键下载电路</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 HelsingenMersken<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>